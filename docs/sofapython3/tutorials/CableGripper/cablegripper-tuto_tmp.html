<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>cablegripper-tuto_tmp</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../../../../docs/style.css" />
</head>
<body>
<p><img src="../../images/pluginimage.png" /></p>
<h2 id="simulating-a-cable-based-soft-gripper">Simulating a cable based soft gripper</h2>
<p>This tutorial describes how to set-up a simulation environment, a scene, using <a href="https://www.sofa-framework.org/">SOFA</a>and how to use the <a href="https://project.inria.fr/softrobot/">SoftRobots</a>plugin to model a virtual soft gripper driven by cables. The design of the gripper we are going to model is from <a href="https://dl.acm.org/citation.cfm?id=2977533">Taimoor Hassan et al. </a>. Once modeled in Sofa the robot can be simulated and controlled as in:</p>
<center>
<object style="width: 320px; height: 200px;" data="https://www.youtube.com/embed/9JOCe2pf34o?autoplay=0">
</object>
</center>
<p>Tutorials prequisites:</p>
<ul>
<li><p>installed <a href="https://www.sofa-framework.org/">SOFA</a>with the <a href="http://stlib.readthedocs.io/en/latest/">STLIB</a>and <a href="https://project.inria.fr/softrobot/">SoftRobots</a>plugins.</p></li>
<li><p>you have basic knowledge of the <a href="https://www.python.org/">Python</a>programming language. If not you can go to ..autolink::General::PythonTutorials.</p></li>
<li><p>you have basic knowledge of making scene with Sofa. If not, please complete the <a href="../FirstSteps/firststeps-tuto.html?sofafile=firststeps-tuto.pyscn">FirstStep</a>first.</p></li>
</ul>
<h3 id="step-0-try-the-simulation-in-sofa">Step 0: Try the simulation in Sofa</h3>
<p>Before continuing this tutorial try the resulting simulation you need to achieved.</p>
You can load the scene directly from this documentation by clicking on the following:
<div>
<pre>
<a href="details/step0.pyscn"> <img src="../../images/icons/play.png" width="12px"/> Try now the scene in Sofa.</a>
</pre>
</div>
<p>Once loaded you can now click on the [Animate] button in the Sofa GUI and start interacting in the 3D window. When your cursor have clicked on the 3D window you can control the simulation to manipulate the gripper by pressing the following keys:</p>
<ul>
<li>ctrl + <em>+</em> to close the gripper</li>
<li>ctrl + <em>-</em> to open the gripper</li>
<li>ctrl + <em>arrow up</em> to move it up</li>
<li>ctrl + <em>arrow down</em> to move it down</li>
<li>ctrl + <em>arrow left</em> to move it left</li>
<li>ctrl + <em>arrow right</em> to move it right</li>
</ul>
<p>Note that with MacOS, you may have to use <em>cmd</em> instead of <em>ctrl</em>.</p>
<h3 id="step-1-setting-up-simple-scene">Step 1: Setting up simple scene</h3>
<p>Sofa is loading the description of the simulation from <em>pyscn</em> files. The content of these file is in fact standard python code with at least one function named <em>createScene</em> taking a single parameter, the root of the scene hierarchy. This function is the entry point used by Sofa to fill the simulation’s content and this is the place where you will type your scene’s description. A scene is an ordered tree of nodes (ex:gripper.), with parent/child relationship (ex: finger). Each node has one or a few components. Every node and component has a name and a few features. The main node at the top of the tree is called “rootNode”.</p>
A very simple scene may look like:
<div>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" title="1"><span class="im">from</span> stlib.visuals <span class="im">import</span> ShowGrid</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="im">from</span> stlib.physics.rigid <span class="im">import</span> ..autolink::STLIB::Floor</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="im">from</span> stlib.physics.rigid <span class="im">import</span> ..autolink::STLIB::Cube</a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw">def</span> createScene(rootNode):</a>
<a class="sourceLine" id="cb1-6" title="6">    <span class="co">&quot;&quot;&quot;This is my first scene&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-7" title="7">    ShowGrid(rootNode)</a>
<a class="sourceLine" id="cb1-8" title="8"></a>
<a class="sourceLine" id="cb1-9" title="9">    ..autolink::STLIB::Floor(rootNode,</a>
<a class="sourceLine" id="cb1-10" title="10">          translation<span class="op">=</span>[<span class="fl">0.0</span>,<span class="fl">0.0</span>,<span class="fl">0.0</span>],</a>
<a class="sourceLine" id="cb1-11" title="11">          isAStaticObject<span class="op">=</span><span class="va">True</span>)</a>
<a class="sourceLine" id="cb1-12" title="12"></a>
<a class="sourceLine" id="cb1-13" title="13">    ..autolink::STLIB::Cube(rootNode,</a>
<a class="sourceLine" id="cb1-14" title="14">          translation<span class="op">=</span>[<span class="fl">0.0</span>,<span class="fl">0.0</span>,<span class="fl">0.0</span>])</a>
<a class="sourceLine" id="cb1-15" title="15"></a>
<a class="sourceLine" id="cb1-16" title="16"></a>
<a class="sourceLine" id="cb1-17" title="17">    <span class="cf">return</span> rootNode</a></code></pre></div>
<div>
<pre>
<a href="details/step1.pyscn"> <img src="../../images/icons/play.png" width="16px"/>Show me the result.</a>
<a href="myproject/cablegripper.pyscn"> <img src="../../images/icons/play.png" width="16px"/>Do it yourself.</a>
</pre>
</div>
</div>
<p>####<i>Comments (things to present or do in this step):</i></p>
<ul>
<li><p>load “cablegripper.pyscn” in sofa (with option ‘-i’) and in your text editor</p></li>
<li><p>add a floor and a cube in the scene</p></li>
<li><p>show the scene graph structure and compare it with the content of the scene.</p></li>
<li><p>move the floor so that it is -160 along they y Axis.</p></li>
</ul>
<h3 id="step-2-modeling-and-simulating-the-grippers-finger-deformations">Step 2: Modeling and simulating the gripper’s finger deformations</h3>
<p>We will now add a deformable object to a scene. There exists a lot of different mechanical behavior and it is important to understand the one that approximates the behavior of the real object your want to simulate. In particular, it is important to know how soft or stiff the material is, if it has an elastic or more complex behaviour (Hyperelastic, plastic, etc…). In our case, the real material is silicon which we will approximate with an elastic deformation law and simulate using the Finite Element Method (..autolink::General::FEM). In sofa, the <a href="http://stlib.readthedocs.io/en/latest/_autosummary/_autosummary/stlib.physics.deformable.html#stlib.physics.deformable.ElasticMaterialObject">ElasticMaterialObject</a>from <em>stlib.physics.deformable</em> provides a scene template to easily add such an object in your scene.</p>
<p>To compute the deformation of the object using the Finite Element Method a volumetric representation of shape must be provided. In our case we are using a tetrahedral mesh stored in a “vtk” file. In this tutorial we already provide the appropriate tetrahedral mesh in a file name “<em>finger.vtk</em>”.</p>
Let’s now work in <em>‘finger.py’</em> to add:
<div>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" title="1"><span class="im">from</span> stlib.physics.deformable <span class="im">import</span> ..autolink::STLIB::ElasticMaterialObject</a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">def</span> Finger(parentNode<span class="op">=</span><span class="va">None</span>, name<span class="op">=</span><span class="st">&quot;Finger&quot;</span>,</a>
<a class="sourceLine" id="cb2-4" title="4">           rotation<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>], translation<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>],</a>
<a class="sourceLine" id="cb2-5" title="5">           fixingBox<span class="op">=</span>[<span class="fl">0.0</span>,<span class="fl">0.0</span>,<span class="fl">0.0</span>], pullPointLocation<span class="op">=</span>[<span class="fl">0.0</span>,<span class="fl">0.0</span>,<span class="fl">0.0</span>]):</a>
<a class="sourceLine" id="cb2-6" title="6"></a>
<a class="sourceLine" id="cb2-7" title="7">    finger <span class="op">=</span> Node(parentNode, <span class="st">&quot;Finger&quot;</span>)</a>
<a class="sourceLine" id="cb2-8" title="8">    eobject <span class="op">=</span> ..autolink::STLIB::ElasticMaterialObject(finger,</a>
<a class="sourceLine" id="cb2-9" title="9">                               volumeMeshFileName<span class="op">=</span><span class="st">&quot;data/mesh/finger.vtk&quot;</span>,</a>
<a class="sourceLine" id="cb2-10" title="10">                               poissonRatio<span class="op">=</span><span class="fl">0.3</span>,</a>
<a class="sourceLine" id="cb2-11" title="11">                               youngModulus<span class="op">=</span><span class="dv">18000</span>,</a>
<a class="sourceLine" id="cb2-12" title="12">                               totalMass<span class="op">=</span><span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb2-13" title="13">                               surfaceColor<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">0.8</span>, <span class="fl">0.7</span>],</a>
<a class="sourceLine" id="cb2-14" title="14">                               surfaceMeshFileName<span class="op">=</span><span class="st">&quot;data/mesh/finger.stl&quot;</span>,</a>
<a class="sourceLine" id="cb2-15" title="15">                               rotation<span class="op">=</span>rotation,</a>
<a class="sourceLine" id="cb2-16" title="16">                               translation<span class="op">=</span>translation)</a>
<a class="sourceLine" id="cb2-17" title="17"></a>
<a class="sourceLine" id="cb2-18" title="18">    <span class="cf">return</span> finger</a></code></pre></div>
<div>
<pre>
<a href="details/step2.pyscn"> <img src="../../images/icons/play.png" width="12px"/> Show me the result.</a>
<a href="myproject/finger.py"> <img src="../../images/icons/play.png" width="12px"/> Do it yourself.</a>
</pre>
</div>
</div>
<p>If you run the the scene you can see the tetrahedral mesh with blue-ish element. To control the visualization of this computation mesh you can either check the “Force Fields” option within the <em>View</em> panel in the runSofa GUI or, as we did, change the displayFlags property of the ..autolink::Sofa::VisualStyle. In case you want to learn more about volumetric mesh generation there is a dedicated tutorial called ..autolink::SoftRobots::Docs::MeshGeneration.</p>
<p>Still in the finger.py file we need to add a fixing box to avoid the free falling the finger under gravity. This can be done in the following way:</p>
Let’s now work in <em>‘finger.py’</em> to add:
<div>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" title="1"><span class="im">from</span> stlib.physics.constraint <span class="im">import</span> FixedBox</a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="kw">def</span> Finger(parentNode<span class="op">=</span><span class="va">None</span>, name<span class="op">=</span><span class="st">&quot;Finger&quot;</span>,</a>
<a class="sourceLine" id="cb3-4" title="4">           rotation<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>], translation<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>],</a>
<a class="sourceLine" id="cb3-5" title="5">           fixingBox<span class="op">=</span>[<span class="fl">0.0</span>,<span class="fl">0.0</span>,<span class="fl">0.0</span>], pullPointLocation<span class="op">=</span>[<span class="fl">0.0</span>,<span class="fl">0.0</span>,<span class="fl">0.0</span>]):</a>
<a class="sourceLine" id="cb3-6" title="6"></a>
<a class="sourceLine" id="cb3-7" title="7">    finger <span class="op">=</span> ..autolink::STLIB::Node(parentNode, name)</a>
<a class="sourceLine" id="cb3-8" title="8">    eobject <span class="op">=</span> ..autolink::STLIB::ElasticMaterialObject(finger,</a>
<a class="sourceLine" id="cb3-9" title="9">                               volumeMeshFileName<span class="op">=</span><span class="st">&quot;data/mesh/finger.vtk&quot;</span>,</a>
<a class="sourceLine" id="cb3-10" title="10">                               poissonRatio<span class="op">=</span><span class="fl">0.3</span>,</a>
<a class="sourceLine" id="cb3-11" title="11">                               youngModulus<span class="op">=</span><span class="dv">18000</span>,</a>
<a class="sourceLine" id="cb3-12" title="12">                               totalMass<span class="op">=</span><span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb3-13" title="13">                               surfaceColor<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">0.8</span>, <span class="fl">0.7</span>],</a>
<a class="sourceLine" id="cb3-14" title="14">                               surfaceMeshFileName<span class="op">=</span><span class="st">&quot;data/mesh/finger.stl&quot;</span>,</a>
<a class="sourceLine" id="cb3-15" title="15">                               rotation<span class="op">=</span>rotation,</a>
<a class="sourceLine" id="cb3-16" title="16">                               translation<span class="op">=</span>translation)</a>
<a class="sourceLine" id="cb3-17" title="17"></a>
<a class="sourceLine" id="cb3-18" title="18">    ..autolink::STLIB::FixedBox(eobject, atPositions<span class="op">=</span>[<span class="op">-</span><span class="dv">10</span>,<span class="op">-</span><span class="dv">10</span>,<span class="op">-</span><span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">15</span>],</a>
<a class="sourceLine" id="cb3-19" title="19">                      doVisualization<span class="op">=</span><span class="va">True</span>)</a>
<a class="sourceLine" id="cb3-20" title="20"></a>
<a class="sourceLine" id="cb3-21" title="21">    <span class="cf">return</span> finger</a></code></pre></div>
<div>
<pre>
<a href="details/step2.2.pyscn"> <img src="../../images/icons/play.png" width="16px"/>Show me the result.</a>
<a href="myproject/finger.py"> <img src="../../images/icons/play.png" width="16px"/>Do it yourself.</a>
</pre>
</div>
</div>
<p>####<i>Comments (things to present or do in this step):</i></p>
<ul>
<li><p>Load the file ‘finger.py’ in runSofa and in your text editor.</p></li>
<li><p>In <em>finger.py</em>, add an elastic object in a similar way to the one given in example 2.</p></li>
<li><p>Gives a small explanation of how the arguments are passed. s</p></li>
<li><p>Gives a small explanation of the role of the poisson ratio parameter.</p></li>
<li><p>Gives a small explanation of the role of the young modulus parameter.</p></li>
<li><p>Instead of displaying the tetrahedron mesh computational structure it is possible to wrap it into a visual model. This visual model can be of much higher visual quality and is deformed according to the deformation of the underlying mecanical mesh. To add such visual model you simply need to add <em>surfaceMeshFileName=“data/mesh/finger.stl”</em> to the <a href="http://stlib.readthedocs.io/en/latest/_autosummary/_autosummary/stlib.physics.deformable.html#stlib.physics.deformable.ElasticMaterialObject">ElasticMaterialObject</a>template’s arguments.</p></li>
<li><p>In <em>finger.py</em> add a <a href="http://stlib.readthedocs.io/en/latest/_autosummary/_autosummary/stlib.physics.constraints.html#stlib.physics.constraints.FixedBox">FixedBox</a>constraint to hold one of the finger extremities so that the object stops free falling because of gravity. This should result in the following simulation:</p></li>
<li><p>In <em>finger.py</em> forward the different arguments specifying the position of the finger to the ElasticMaterialObject and the FixedBox.</p></li>
</ul>
<h2 id="step-3-actuating-the-finger-with-a-cable">Step 3: Actuating the finger with a cable</h2>
<p>In the previous step, we showed how to add a finger shape object made of silicone rubber. We will now actuate it using a 1d inelastic cable attached to the fingertip and passing through the object geomertry.</p>
To model the cable you can use the <a href="http://softrobots.readthedocs.io/en/documentation/_autosummary/softrobots.actuators.html#softrobots.actuators.PullingCable">PullingCable</a>template from the <a href="https://project.inria.fr/softrobot/">SoftRobots</a>plugin and use it in the following way:
<div>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" title="1"><span class="co">### ... similar to previous step ....</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="im">from</span> softrobots.actuators <span class="im">import</span> ..autolink::SoftRobots::PullingCable</a>
<a class="sourceLine" id="cb4-3" title="3"><span class="im">from</span> splib.loaders <span class="im">import</span> loadPointListFromFile</a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">### ... similar to previous step ....</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="kw">def</span> Finger(parentNode):</a>
<a class="sourceLine" id="cb4-7" title="7">    <span class="co">### ... similar to previous step ....</span></a>
<a class="sourceLine" id="cb4-8" title="8"></a>
<a class="sourceLine" id="cb4-9" title="9">    cable <span class="op">=</span> ..autolink::SoftRobots::PullingCable(eobject, cableGeometry<span class="op">=</span>loadPointListFromFile(<span class="st">&quot;data/mesh/cable.json&quot;</span>))</a></code></pre></div>
<div>
<pre>
<a href="details/step3.pyscn"> <img src="../../images/icons/play.png" width="12px"/> Show me the result.</a>
<a href="myproject/finger.py"> <img src="../../images/icons/play.png" width="12px"/> Do it yourself.</a>
</pre>
</div>
</div>
<p>The cable has rest lenght that can be changed interactively using a dedicated python object called a <em>PythonScriptController</em> to connect key pressed on ctrl+ and ctrl- touch to a change of cable length.</p>
You can create your own controllers by in-heriting from the <em>Sofa.PythonScriptController</em> class and redefine the <em>onKeyPressed</em> method. As in
<div>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb5-1" title="1"><span class="im">import</span> Sofa</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">class</span> FingerController(Sofa.PythonScriptController):</a>
<a class="sourceLine" id="cb5-3" title="3">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, node, cable):</a>
<a class="sourceLine" id="cb5-4" title="4">        <span class="va">self</span>.cableconstraintvalue <span class="op">=</span> cable.getObject(<span class="st">&quot;CableConstraint&quot;</span>).findData(<span class="st">&#39;value&#39;</span>)</a>
<a class="sourceLine" id="cb5-5" title="5">        <span class="va">self</span>.name <span class="op">=</span> <span class="st">&quot;FingerController&quot;</span></a>
<a class="sourceLine" id="cb5-6" title="6"></a>
<a class="sourceLine" id="cb5-7" title="7">    <span class="kw">def</span> onKeyPressed(<span class="va">self</span>,c):</a>
<a class="sourceLine" id="cb5-8" title="8">        <span class="cf">if</span> (c <span class="op">==</span> <span class="st">&quot;+&quot;</span>):</a>
<a class="sourceLine" id="cb5-9" title="9">            <span class="va">self</span>.cableconstraintvalue.value <span class="op">=</span>  <span class="va">self</span>.cableconstraintvalue.value[<span class="dv">0</span>][<span class="dv">0</span>] <span class="op">+</span> <span class="fl">1.</span></a>
<a class="sourceLine" id="cb5-10" title="10">        <span class="cf">if</span> (c <span class="op">==</span> <span class="st">&quot;-&quot;</span>):</a>
<a class="sourceLine" id="cb5-11" title="11">            <span class="va">self</span>.cableconstraintvalue.value <span class="op">=</span>  <span class="va">self</span>.cableconstraintvalue.value[<span class="dv">0</span>][<span class="dv">0</span>] <span class="op">-</span> <span class="fl">1.</span></a></code></pre></div>
</div>
The controller can then be attached to the object <em>finger</em> it is supposed to control by doing:
<div>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb6-1" title="1">    <span class="co">## This create a PythonScriptController that permits to programatically implement new behavior</span></a>
<a class="sourceLine" id="cb6-2" title="2">    <span class="co">## or interactions using the Python programming langage. </span></a>
<a class="sourceLine" id="cb6-3" title="3">    FingerController(eobject, cable)</a></code></pre></div>
<div>
<pre>
<a href="details/step3.pyscn"> <img src="../../images/icons/play.png" width="12px"/> Show me the result.</a>
<a href="myproject/finger.py"> <img src="../../images/icons/play.png" width="12px"/> Do it yourself.</a>
</pre>
</div>
</div>
<p>####<i>Comments (things to present or do lively) </i></p>
<ul>
<li><p>In <em>finger.py</em>, add the pulling cable to the finger as shown in the example.</p></li>
<li><p>In <em>‘fingercontroller.py’</em> show there is some print in the console indicating that the key is pressed.</p></li>
<li><p>In <em>fingercontroller.py</em> add the code so that the the cable length is changed on ky pressed with - and +. Implement the release of the cable when the key ‘-’ is pressed.</p></li>
</ul>
<h2 id="step-4-defining-collision-regions">Step 4: Defining collision regions</h2>
<p>By default Sofa doesn’t handle collision as they are very expensive to compute. To activate collisions you need to define specially the geometries for which collions are checked and how they are handled. This can be done by adding a dedicated structure called a ..autolink::STLIB::CollisionMesh. By default self-collision are not handled which, if the object is strongly deformable leads some undesireable behaviors as illustrated in the figure below.</p>
<p><img src="images/NoCollisionRegions.png" width="350"> <img src="images/CollisionRegions2.png" width="350"></p>
<p>Additional <a href="http://stlib.readthedocs.io/en/latest/_autosummary/_autosummary/stlib.physics.collision.html#stlib.physics.collision.CollisionMesh">CollisionMesh</a>are required to precisely define the self-collision behavior.</p>
The finger.py file should now contains :
<div>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb7-1" title="1"><span class="co">## ... Same imports as in step 3 ...</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="im">from</span> stlib.physics.collision <span class="im">import</span> ..autolink::STLIB::CollisionMesh</a>
<a class="sourceLine" id="cb7-3" title="3"></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co">## ... Same as in step 3 ...</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="kw">def</span> Finger(parentNode):</a>
<a class="sourceLine" id="cb7-6" title="6">    <span class="co">## ... the finger</span></a>
<a class="sourceLine" id="cb7-7" title="7">    <span class="co">## ... the cable..</span></a>
<a class="sourceLine" id="cb7-8" title="8">    <span class="co">## ... the controller..</span></a>
<a class="sourceLine" id="cb7-9" title="9"></a>
<a class="sourceLine" id="cb7-10" title="10">    ..autolink::STLIB::CollisionMesh(eobject,</a>
<a class="sourceLine" id="cb7-11" title="11">         surfaceMeshFileName<span class="op">=</span><span class="st">&quot;data/mesh/finger.stl&quot;</span>, name<span class="op">=</span><span class="st">&quot;part0&quot;</span>, collisionGroup<span class="op">=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb7-12" title="12"></a>
<a class="sourceLine" id="cb7-13" title="13"></a>
<a class="sourceLine" id="cb7-14" title="14">    ..autolink::STLIB::CollisionMesh(eobject,</a>
<a class="sourceLine" id="cb7-15" title="15">             surfaceMeshFileName<span class="op">=</span><span class="st">&quot;data/mesh/fingerCollision_part1.stl&quot;</span>, name<span class="op">=</span><span class="st">&quot;part1&quot;</span>, collisionGroup<span class="op">=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb7-16" title="16"></a>
<a class="sourceLine" id="cb7-17" title="17">    ..autolink::STLIB::CollisionMesh(eobject,</a>
<a class="sourceLine" id="cb7-18" title="18">              surfaceMeshFileName<span class="op">=</span><span class="st">&quot;data/mesh/fingerCollision_part2.stl&quot;</span>, name<span class="op">=</span><span class="st">&quot;part2&quot;</span>, collisionGroup<span class="op">=</span><span class="dv">2</span>)</a></code></pre></div>
<div>
<pre>
<a href="details/step4.pyscn"> <img src="../../images/icons/play.png" width="16px"/>Show me the result.</a>
<a href="myproject/finger.py"> <img src="../../images/icons/play.png" width="16px"/>Do it yourself.</a>
</pre>
</div>
</div>
<p>The <a href="http://stlib.readthedocs.io/en/latest/_autosummary/_autosummary/stlib.physics.collision.html#stlib.physics.collision.CollisionMesh">CollisionMesh</a>are set of triangles, each set can be part of one or multiple collision group. By using the <em>“collisionGroup”</em> option you can specify the group of which the <a href="http://stlib.readthedocs.io/en/latest/_autosummary/_autosummary/stlib.physics.collision.html#stlib.physics.collision.CollisionMesh">CollisionMesh</a>belong to. Triangle from different collision groupes are tested for intersections and contact handling.</p>
<p>####<i>Comments:</i></p>
<ul>
<li><p>Explain the import of the CollisionMesh (if it was not done before)</p></li>
<li><p>Explain the load of the mesh…</p></li>
<li><p>Explain the role of collision group. Object in two different groups can collide.</p></li>
<li><p>Explain the contactDistance parameters</p></li>
</ul>
<h2 id="step-5-duplicating-the-finger-to-make-a-complete-gripper">Step 5: Duplicating the finger to make a complete gripper</h2>
<p>Now we have a working single finger we can duplicate it so that it can match the orginal soft gripper robot design that contains three of them.</p>
<figure>
<img src="images/gripper.png" alt="The soft gripper with three fingers" data-with="300" /><figcaption>The soft gripper with three fingers</figcaption>
</figure>
At this point the <em>finger.py</em> file should contains something similar to:
<div>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb8-1" title="1"><span class="co"># -*- coding: utf-8 -*-</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="im">import</span> Sofa</a>
<a class="sourceLine" id="cb8-3" title="3"><span class="im">from</span> stlib.scene <span class="im">import</span> ..autolink::STLIB::Node</a>
<a class="sourceLine" id="cb8-4" title="4"><span class="im">from</span> stlib.physics.deformable <span class="im">import</span> ..autolink::STLIB::ElasticMaterialObject</a>
<a class="sourceLine" id="cb8-5" title="5"><span class="im">from</span> stlib.physics.constraints <span class="im">import</span> ..autolink::STLIB::FixedBox</a>
<a class="sourceLine" id="cb8-6" title="6"><span class="im">from</span> stlib.physics.collision <span class="im">import</span> ..autolink::STLIB::CollisionMesh</a>
<a class="sourceLine" id="cb8-7" title="7"><span class="im">from</span> splib.loaders <span class="im">import</span> loadPointListFromFile</a>
<a class="sourceLine" id="cb8-8" title="8"><span class="im">from</span> softrobots.actuators <span class="im">import</span> ..autolink::SoftRobots::PullingCable</a>
<a class="sourceLine" id="cb8-9" title="9"></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="kw">class</span> FingerController(Sofa.PythonScriptController):</a>
<a class="sourceLine" id="cb8-11" title="11">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, node, cable ):</a>
<a class="sourceLine" id="cb8-12" title="12">        <span class="va">self</span>.cableconstraintvalue <span class="op">=</span> cable.getObject(<span class="st">&quot;CableConstraint&quot;</span>).findData(<span class="st">&#39;value&#39;</span>)</a>
<a class="sourceLine" id="cb8-13" title="13">        <span class="va">self</span>.name <span class="op">=</span> <span class="st">&quot;FingerController&quot;</span></a>
<a class="sourceLine" id="cb8-14" title="14"></a>
<a class="sourceLine" id="cb8-15" title="15">    <span class="kw">def</span> onKeyPressed(<span class="va">self</span>,c):</a>
<a class="sourceLine" id="cb8-16" title="16">        <span class="cf">if</span> (c <span class="op">==</span> <span class="st">&quot;+&quot;</span>):</a>
<a class="sourceLine" id="cb8-17" title="17">            <span class="va">self</span>.cableconstraintvalue.value <span class="op">=</span>  <span class="va">self</span>.cableconstraintvalue.value[<span class="dv">0</span>][<span class="dv">0</span>] <span class="op">+</span> <span class="fl">1.</span></a>
<a class="sourceLine" id="cb8-18" title="18"></a>
<a class="sourceLine" id="cb8-19" title="19">        <span class="cf">elif</span> (c <span class="op">==</span> <span class="st">&quot;-&quot;</span>):</a>
<a class="sourceLine" id="cb8-20" title="20">            displacement <span class="op">=</span> <span class="va">self</span>.cableconstraintvalue.value[<span class="dv">0</span>][<span class="dv">0</span>] <span class="op">-</span> <span class="fl">1.</span></a>
<a class="sourceLine" id="cb8-21" title="21">            <span class="cf">if</span>(displacement <span class="op">&lt;</span> <span class="dv">0</span>):</a>
<a class="sourceLine" id="cb8-22" title="22">                displacement <span class="op">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb8-23" title="23">            <span class="va">self</span>.cableconstraintvalue.value <span class="op">=</span> displacement</a>
<a class="sourceLine" id="cb8-24" title="24"></a>
<a class="sourceLine" id="cb8-25" title="25"><span class="kw">def</span> Finger(parentNode<span class="op">=</span><span class="va">None</span>, name<span class="op">=</span><span class="st">&quot;Finger&quot;</span>,</a>
<a class="sourceLine" id="cb8-26" title="26">           rotation<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>], translation<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>],</a>
<a class="sourceLine" id="cb8-27" title="27">           fixingBox<span class="op">=</span>[<span class="fl">0.0</span>,<span class="fl">0.0</span>,<span class="fl">0.0</span>], pullPointLocation<span class="op">=</span>[<span class="fl">0.0</span>,<span class="fl">0.0</span>,<span class="fl">0.0</span>]):</a>
<a class="sourceLine" id="cb8-28" title="28"></a>
<a class="sourceLine" id="cb8-29" title="29">    finger <span class="op">=</span> ..autolink::STLIB::Node(parentNode, name)</a>
<a class="sourceLine" id="cb8-30" title="30">    eobject <span class="op">=</span> ..autolink::STLIB::ElasticMaterialObject(finger,</a>
<a class="sourceLine" id="cb8-31" title="31">                                   volumeMeshFileName<span class="op">=</span><span class="st">&quot;data/mesh/finger.vtk&quot;</span>,</a>
<a class="sourceLine" id="cb8-32" title="32">                                   poissonRatio<span class="op">=</span><span class="fl">0.3</span>,</a>
<a class="sourceLine" id="cb8-33" title="33">                                   youngModulus<span class="op">=</span><span class="dv">100</span>,</a>
<a class="sourceLine" id="cb8-34" title="34">                                   totalMass<span class="op">=</span><span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb8-35" title="35">                                   surfaceColor<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">0.8</span>, <span class="fl">0.7</span>],</a>
<a class="sourceLine" id="cb8-36" title="36">                                   surfaceMeshFileName<span class="op">=</span><span class="st">&quot;data/mesh/finger.stl&quot;</span>,</a>
<a class="sourceLine" id="cb8-37" title="37">                                   rotation<span class="op">=</span>rotation,</a>
<a class="sourceLine" id="cb8-38" title="38">                                   translation<span class="op">=</span>translation)</a>
<a class="sourceLine" id="cb8-39" title="39"></a>
<a class="sourceLine" id="cb8-40" title="40">    ..autolink::STLIB::FixedBox(eobject, atPositions<span class="op">=</span>fixingBox, doVisualization<span class="op">=</span><span class="va">True</span>)</a>
<a class="sourceLine" id="cb8-41" title="41"></a>
<a class="sourceLine" id="cb8-42" title="42">    cable<span class="op">=</span>..autolink::SoftRobots::PullingCable(eobject,</a>
<a class="sourceLine" id="cb8-43" title="43">                 <span class="st">&quot;PullingCable&quot;</span>,</a>
<a class="sourceLine" id="cb8-44" title="44">                 pullPointLocation<span class="op">=</span>pullPointLocation,</a>
<a class="sourceLine" id="cb8-45" title="45">                 rotation<span class="op">=</span>rotation,</a>
<a class="sourceLine" id="cb8-46" title="46">                 translation<span class="op">=</span>translation,</a>
<a class="sourceLine" id="cb8-47" title="47">                 cableGeometry<span class="op">=</span>loadPointListFromFile(<span class="st">&quot;data/mesh/cable.json&quot;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb8-48" title="48"></a>
<a class="sourceLine" id="cb8-49" title="49">    FingerController(eobject, cable)</a>
<a class="sourceLine" id="cb8-50" title="50"></a>
<a class="sourceLine" id="cb8-51" title="51">    ..autolink::STLIB::CollisionMesh(eobject, name<span class="op">=</span><span class="st">&quot;CollisionMesh&quot;</span>,</a>
<a class="sourceLine" id="cb8-52" title="52">                 surfaceMeshFileName<span class="op">=</span><span class="st">&quot;data/mesh/finger.stl&quot;</span>,</a>
<a class="sourceLine" id="cb8-53" title="53">                 rotation<span class="op">=</span>rotation, translation<span class="op">=</span>translation,</a>
<a class="sourceLine" id="cb8-54" title="54">                 collisionGroup<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>])</a>
<a class="sourceLine" id="cb8-55" title="55"></a>
<a class="sourceLine" id="cb8-56" title="56">    ..autolink::STLIB::CollisionMesh(eobject, name<span class="op">=</span><span class="st">&quot;CollisionMeshAuto1&quot;</span>,</a>
<a class="sourceLine" id="cb8-57" title="57">                 surfaceMeshFileName<span class="op">=</span><span class="st">&quot;data/mesh/fingerCollision_part1.stl&quot;</span>,</a>
<a class="sourceLine" id="cb8-58" title="58">                 rotation<span class="op">=</span>rotation, translation<span class="op">=</span>translation,</a>
<a class="sourceLine" id="cb8-59" title="59">                 collisionGroup<span class="op">=</span>[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb8-60" title="60"></a>
<a class="sourceLine" id="cb8-61" title="61">    ..autolink::STLIB::CollisionMesh(eobject, name<span class="op">=</span><span class="st">&quot;CollisionMeshAuto2&quot;</span>,</a>
<a class="sourceLine" id="cb8-62" title="62">                 surfaceMeshFileName<span class="op">=</span><span class="st">&quot;data/mesh/fingerCollision_part2.stl&quot;</span>,</a>
<a class="sourceLine" id="cb8-63" title="63">                 rotation<span class="op">=</span>rotation, translation<span class="op">=</span>translation,</a>
<a class="sourceLine" id="cb8-64" title="64">                 collisionGroup<span class="op">=</span>[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb8-65" title="65"></a>
<a class="sourceLine" id="cb8-66" title="66"></a>
<a class="sourceLine" id="cb8-67" title="67">    <span class="cf">return</span> finger</a></code></pre></div>
</div>
The file <em>‘gripper.py’</em> should contains:
<div>
<p>import Sofa from grippercontroller import GripperController from finger import Finger</p>
<p>def Gripper(parentNode=None): selfNode = parentNode.createChild(“Gripper”)</p>
<pre><code>f1 = Finger(selfNode, &quot;Finger1&quot;,
       rotation=[0, 0, 105],
       translation=[20.0,0.0, 0.0],
       fixingBox=[-20, -10, 0, 20, 10, 15],
       pullPointLocation=[3, 10.5, 3])

f2 = Finger(selfNode, &quot;Finger2&quot;,
       rotation=[180, 0, 65],
       translation=[-10.0,0.0, -4.0],
       fixingBox=[-20, -10, -30, 20, 10, 0],
       pullPointLocation=[3, 10.5, -7])

f3 = Finger(selfNode, &quot;Finger3&quot;,
       rotation=[180, 0, 65],
       translation=[-10.0,0.0, 34.0],
       fixingBox=[-20, -10, 0, 20, 10, 50],
       pullPointLocation=[3, 10.5, 31.5])

GripperController(selfNode, [f1,f2,f3])

return selfNode</code></pre>
```
<div>
<pre>
<a href="details/step5.pyscn"> <img src="../../images/icons/play.png" width="16px"/>Show me the result.</a>
<a href="myproject/gripper.py"> <img src="../../images/icons/play.png" width="16px"/>Do it yourself.</a>
</pre>
</div>
</div>
<p>####<i>Comments:</i></p>
<ul>
<li><p>In <em>gripper.py</em>, show how to add one finger at default position and location. Do not forget that you can start Sofa with the ‘-i’ option for an automatic reload of the ‘gripper.py’ each time the source file is changed.</p></li>
<li><p>In <em>gripper.py</em>, duplicate the Finger object and change the location, orientation and fixing point so that it match the desired robot geometry of the gripper. Do not forget that you can start Sofa with the ‘-i’ option for an automatic reload of the ‘gripper.py’ each time the source file is changed.</p></li>
<li><p>Attach the GripperController to the Gripper object. So that when you press CTRL+UP/DOWN/LEFT/RIGHT the gripper is moving.</p></li>
</ul>
<h2 id="step-6-putting-everything-in-a-single-simulation.">Step 6: Putting everything in a single simulation.</h2>
Open the <em>‘cablegripper.pyscn’</em> and add the Cube, the Floor and the Gripper which should resuts in something similar to:
<div>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb10-1" title="1"><span class="im">from</span> stlib.scene <span class="im">import</span> ..autolink::STLIB::MainHeader, ..autolink::STLIB::ContactHeader</a>
<a class="sourceLine" id="cb10-2" title="2"><span class="im">from</span> stlib.physics.rigid <span class="im">import</span> ..autolink::STLIB::Floor, ..autolink::STLIB::Cube</a>
<a class="sourceLine" id="cb10-3" title="3"><span class="im">from</span> gripper <span class="im">import</span> Gripper</a>
<a class="sourceLine" id="cb10-4" title="4"></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="kw">def</span> createScene(rootNode):</a>
<a class="sourceLine" id="cb10-6" title="6">    <span class="co">&quot;&quot;&quot;This is my first scene&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb10-7" title="7">    ..autolink::STLIB::MainHeader(rootNode, gravity<span class="op">=</span>[<span class="fl">0.0</span>, <span class="fl">-981.0</span>, <span class="fl">0.0</span>], plugins<span class="op">=</span>[<span class="st">&quot;SoftRobots&quot;</span>])</a>
<a class="sourceLine" id="cb10-8" title="8">    ..autolink::STLIB::ContactHeader(rootNode, alarmDistance<span class="op">=</span><span class="dv">4</span>, contactDistance<span class="op">=</span><span class="dv">3</span>, frictionCoef<span class="op">=</span><span class="fl">0.08</span>)</a>
<a class="sourceLine" id="cb10-9" title="9"></a>
<a class="sourceLine" id="cb10-10" title="10">    Gripper(rootNode)</a>
<a class="sourceLine" id="cb10-11" title="11"></a>
<a class="sourceLine" id="cb10-12" title="12">    ..autolink::STLIB::Floor(rootNode, name<span class="op">=</span><span class="st">&quot;Floor&quot;</span>,</a>
<a class="sourceLine" id="cb10-13" title="13">          color<span class="op">=</span>[<span class="fl">1.0</span>,<span class="fl">0.0</span>,<span class="fl">0.0</span>],</a>
<a class="sourceLine" id="cb10-14" title="14">          translation<span class="op">=</span>[<span class="fl">0.0</span>,<span class="op">-</span><span class="fl">160.0</span>,<span class="fl">0.0</span>],</a>
<a class="sourceLine" id="cb10-15" title="15">          isAStaticObject<span class="op">=</span><span class="va">True</span>)</a>
<a class="sourceLine" id="cb10-16" title="16"></a>
<a class="sourceLine" id="cb10-17" title="17">    ..autolink::STLIB::Cube(rootNode, name<span class="op">=</span><span class="st">&quot;Cube&quot;</span>,</a>
<a class="sourceLine" id="cb10-18" title="18">          uniformScale<span class="op">=</span><span class="fl">20.0</span>,</a>
<a class="sourceLine" id="cb10-19" title="19">          color<span class="op">=</span>[<span class="fl">1.0</span>,<span class="fl">1.0</span>,<span class="fl">0.0</span>],</a>
<a class="sourceLine" id="cb10-20" title="20">          totalMass<span class="op">=</span><span class="fl">0.03</span>,</a>
<a class="sourceLine" id="cb10-21" title="21">          volume<span class="op">=</span><span class="dv">20</span>,</a>
<a class="sourceLine" id="cb10-22" title="22">          inertiaMatrix<span class="op">=</span>[<span class="fl">1000.0</span>,<span class="fl">0.0</span>,<span class="fl">0.0</span>,<span class="fl">0.0</span>,<span class="fl">1000.0</span>,<span class="fl">0.0</span>,<span class="fl">0.0</span>,<span class="fl">0.0</span>,<span class="fl">1000.0</span>],</a>
<a class="sourceLine" id="cb10-23" title="23">          translation<span class="op">=</span>[<span class="fl">0.0</span>,<span class="op">-</span><span class="fl">130.0</span>,<span class="fl">10.0</span>])</a>
<a class="sourceLine" id="cb10-24" title="24"></a>
<a class="sourceLine" id="cb10-25" title="25">    <span class="cf">return</span> rootNode</a></code></pre></div>
<div>
<pre>
<a href="details/step6.pyscn"> <img src="../../images/icons/play.png" width="12px"/> Show me the result.</a>
<a href="myproject/cablegripper.pyscn"> <img src="../../images/icons/play.png" width="12px"/> Do it yourself.</a>
</pre>
</div>
</div>
<h3 id="conclusion">Conclusion</h3>
<p>Congratulation, you completed this tutorial. You are strongly encouraged to pursue with the other tutorial and read the thematical documentations.</p>
<p>If you have any comments or suggestions, please submit issues on our <a href="https://github.com/SofaDefrost">github/SoftRobots</a>page.</p>
</body>
</html>
